<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Drive Galeria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .media-container { display: flex; flex-wrap: wrap; gap: 10px; }
        .media-item { max-width: 300px; }
        .media-item img, .media-item video { width: 100%; height: auto; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1>Galeria zdjęć i filmów</h1>
        <button id="signInButton" class="btn btn-primary mb-3">Zaloguj się do Google</button>
        <button id="signOutButton" class="btn btn-secondary mb-3" style="display: none;">Wyloguj się</button>
        <div class="mb-3">
            <input type="file" id="fileInput" multiple accept="image/*,video/*" class="form-control">
            <button id="uploadButton" class="btn btn-success mt-2" disabled>Wyślij pliki</button>
        </div>
        <div id="mediaContainer" class="media-container"></div>
    </div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = '423158260926-21qotkdtat68fh814ilqmqkc82rdo1m8.apps.googleusercontent.com'; // Replace with your Google OAuth Client ID
        const API_KEY = 'AIzaSyDbs-HMHt__vQAjeSuU89U4WBhlr5EEnx4'; // Replace with your Google API Key
        const FOLDER_ID = '1XZnCvIUSJ0VQ13AlDJHp8VWSM_zZueTk'; // Replace with your Google Drive folder ID
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        let tokenClient;
        let accessToken = null;

        function initClient() {
            gapi.load('client:auth2', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: DISCOVERY_DOCS,
                }).then(() => {
                    tokenClient = google.accounts.oauth2.initTokenClient({
                        client_id: CLIENT_ID,
                        scope: SCOPES,
                        callback: (tokenResponse) => {
                            accessToken = tokenResponse.access_token;
                            document.getElementById('signInButton').style.display = 'none';
                            document.getElementById('signOutButton').style.display = 'block';
                            document.getElementById('uploadButton').disabled = false;
                            listFiles();
                        },
                    });
                });
            });
        }

        function handleSignIn() {
            tokenClient.requestAccessToken();
        }

        function handleSignOut() {
            if (accessToken) {
                google.accounts.oauth2.revoke(accessToken);
                accessToken = null;
                document.getElementById('signInButton').style.display = 'block';
                document.getElementById('signOutButton').style.display = 'none';
                document.getElementById('uploadButton').disabled = true;
                document.getElementById('mediaContainer').innerHTML = '';
            }
        }

        function listFiles() {
            gapi.client.drive.files.list({
                q: `'${FOLDER_ID}' in parents and (mimeType contains 'image/' or mimeType contains 'video/')`,
                fields: 'files(id, name, mimeType, webContentLink)',
            }).then((response) => {
                const files = response.result.files;
                const container = document.getElementById('mediaContainer');
                container.innerHTML = '';
                files.forEach(file => {
                    const element = file.mimeType.startsWith('image/')
                        ? `<img src="${file.webContentLink}" alt="${file.name}" class="media-item">`
                        : `<video controls src="${file.webContentLink}" class="media-item"></video>`;
                    container.innerHTML += element;
                });
            });
        }

        function uploadFile(file) {
            const metadata = {
                name: file.name,
                mimeType: file.type,
                parents: [FOLDER_ID],
            };
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);

            fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                method: 'POST',
                headers: new Headers({ 'Authorization': `Bearer ${accessToken}` }),
                body: form,
            }).then(() => {
                listFiles();
            }).catch((error) => {
                console.error('Upload error:', error);
            });
        }

        document.getElementById('signInButton').addEventListener('click', handleSignIn);
        document.getElementById('signOutButton').addEventListener('click', handleSignOut);
        document.getElementById('uploadButton').addEventListener('click', () => {
            const files = document.getElementById('fileInput').files;
            for (let file of files) {
                uploadFile(file);
            }
        });

        initClient();
    </script>
</body>
</html>