<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galeria Mi√≥d Malina</title>
  <style>
    :root {
      --peony-pink: #FFF0F3;
      --sage-green: #8BA989;
      --cream: #FFF9E6;
      --deep-pink: #D15A6F;
      --text-dark: #2C2C2C;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Georgia', serif;
    }

    body {
      background: linear-gradient(180deg, var(--peony-pink), var(--cream));
      color: var(--text-dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--sage-green);
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    header h1 {
      font-size: 2.2rem;
      color: var(--cream);
    }

    header p {
      font-size: 1rem;
      color: var(--cream);
      opacity: 0.8;
    }

    .filter-container {
      padding: 1rem;
      text-align: center;
      background: var(--peony-pink);
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .filter-container select, .filter-container button {
      background: var(--deep-pink);
      color: var(--cream);
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.2s, background 0.2s;
    }

    .filter-container button {
      background: var(--sage-green);
    }

    .filter-container select:hover, .filter-container button:hover {
      transform: translateY(-2px);
    }

    .gallery {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .gallery-item {
      background: var(--cream);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      opacity: 0;
      animation: slideIn 0.5s forwards;
      display: flex;
      flex-direction: column;
    }

    .gallery-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    }

    @keyframes slideIn {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .gallery-item img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
      flex-grow: 1;
    }

    .gallery-item p {
      padding: 0.75rem;
      text-align: center;
      font-size: 0.95rem;
      color: var(--text-dark);
      background: rgba(255, 255, 255, 0.8);
      margin: 0;
    }

    .loader {
      display: none;
      text-align: center;
      padding: 2rem;
      font-size: 1.2rem;
      color: var(--deep-pink);
      grid-column: 1 / -1;
    }

    .empty-message {
      text-align: center;
      padding: 2rem;
      font-size: 1.2rem;
      color: var(--text-dark);
      grid-column: 1 / -1;
    }

    .lightbox {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .lightbox-content {
      max-width: 90%;
      max-height: 80%;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
    }

    .lightbox-error {
      display: none;
      color: var(--cream);
      font-size: 1.2rem;
      text-align: center;
      max-width: 80%;
      padding: 2rem;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 8px;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 20px;
      color: var(--cream);
      font-size: 2rem;
      cursor: pointer;
      background: rgba(0, 0, 0, 0.5);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .lightbox-close:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    .lightbox-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      color: var(--cream);
      font-size: 2rem;
      cursor: pointer;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      transition: background 0.2s;
    }

    .lightbox-nav:hover {
      background: rgba(0, 0, 0, 0.8);
    }

    .lightbox-prev {
      left: 20px;
    }

    .lightbox-next {
      right: 20px;
    }

    .lightbox-caption {
      position: absolute;
      bottom: 20px;
      left: 0;
      right: 0;
      text-align: center;
      color: white;
      padding: 10px;
      background: rgba(0, 0, 0, 0.5);
    }

    footer {
      background: var(--sage-green);
      color: var(--cream);
      text-align: center;
      padding: 1rem;
      margin-top: auto;
    }

    @media (max-width: 768px) {
      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }

      header h1 {
        font-size: 1.8rem;
      }

      header p {
        font-size: 0.9rem;
      }
      
      .lightbox-nav {
        font-size: 1.5rem;
        padding: 0.5rem;
      }
    }

    @media (max-width: 480px) {
      .gallery {
        grid-template-columns: 1fr;
      }
      
      .filter-container {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Galeria Mi√≥d Malina</h1>
    <p>Twoje wspomnienia w Google Drive</p>
  </header>

  <div class="filter-container">
    <select id="filter" onchange="filterFiles(this.value)">
      <option value="all">Wszystkie üìÇ</option>
      <option value="image">Zdjƒôcia üñºÔ∏è</option>
      <option value="video">Filmy üé•</option>
    </select>
    <button onclick="loadFiles()">Od≈õwie≈º üîÑ</button>
  </div>

  <div class="gallery" id="gallery">
    <div class="loader" id="loader">≈Åadowanie...</div>
    <div class="empty-message" id="emptyMessage">W folderze nie ma jeszcze ≈ºadnych plik√≥w.</div>
  </div>

  <div class="lightbox" id="lightbox">
    <span class="lightbox-close" onclick="closeLightbox()">√ó</span>
    <span class="lightbox-nav lightbox-prev" onclick="navigateLightbox(-1)">‚Üê</span>
    <img id="lightbox-image" class="lightbox-content" src="" onerror="showLightboxError()">
    <iframe id="lightbox-video" class="lightbox-content" style="display: none;" frameborder="0" allowfullscreen></iframe>
    <div class="lightbox-error" id="lightbox-error">Nie uda≈Ço siƒô za≈Çadowaƒá pliku. Sprawd≈∫ ustawienia udostƒôpniania w Google Drive.</div>
    <div class="lightbox-caption" id="lightbox-caption"></div>
    <span class="lightbox-nav lightbox-next" onclick="navigateLightbox(1)">‚Üí</span>
  </div>

  <footer>
    <p>¬© 2025 Mi√≥d Malina | Wszelkie prawa zastrze≈ºone</p>
  </footer>

  <script>
    // Configuration - replace these with your own values
    const FOLDER_ID = '1XZnCvIUSJ0VQ13AlDJHp8VWSM_zZueTk'; // Your Google Drive folder ID
    const API_KEY = 'AIzaSyDqVvO8j1j3q3q3q3q3q3q3q3q3q3q3q3q'; // Replace with your Google API key
    const CLIENT_ID = '423158260926-21qotkdtat68fh814ilqmqkc82rdo1m8.apps.googleusercontent.com'; // Replace with your OAuth client ID
    
    // State variables
    let allFiles = [];
    let currentFileIndex = 0;
    let filteredFiles = [];
    
    // DOM elements
    const gallery = document.getElementById('gallery');
    const loader = document.getElementById('loader');
    const emptyMessage = document.getElementById('emptyMessage');
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightbox-image');
    const lightboxVideo = document.getElementById('lightbox-video');
    const lightboxError = document.getElementById('lightbox-error');
    const lightboxCaption = document.getElementById('lightbox-caption');

    // Initialize the gallery when the page loads
    window.onload = () => {
      checkAuth();
      // Load files after a short delay to allow auth to complete
      setTimeout(loadFiles, 500);
    };

    // Google API initialization
    function initClient() {
      gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: 'https://www.googleapis.com/auth/drive.readonly',
        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
      }).then(() => {
        console.log('Google API client initialized');
      }).catch(error => {
        console.error('Error initializing Google API client:', error);
        showError('B≈ÇƒÖd inicjalizacji Google API');
      });
    }

    // Check authentication status
    function checkAuth() {
      gapi.load('client:auth2', initClient);
    }

    // Load files from Google Drive
    async function loadFiles() {
      try {
        showLoader();
        clearGallery();
        
        // Check if we have a valid access token
        if (!gapi.auth2.getAuthInstance().isSignedIn.get()) {
          await gapi.auth2.getAuthInstance().signIn();
        }
        
        // Get files from the specified folder
        const response = await gapi.client.drive.files.list({
          q: `'${FOLDER_ID}' in parents and trashed = false`,
          fields: 'files(id,name,mimeType,webContentLink,thumbnailLink,modifiedTime)',
          orderBy: 'name',
          pageSize: 1000
        });
        
        allFiles = response.result.files.map(file => ({
          id: file.id,
          name: file.name,
          mimeType: file.mimeType,
          url: file.webContentLink,
          thumbnail: getThumbnailUrl(file),
          date: file.modifiedTime
        }));
        
        if (allFiles.length === 0) {
          showEmptyMessage();
        } else {
          displayFiles(allFiles);
        }
      } catch (error) {
        console.error('Error loading files:', error);
        showError('B≈ÇƒÖd ≈Çadowania plik√≥w. Sprawd≈∫ po≈ÇƒÖczenie internetowe.');
      } finally {
        hideLoader();
      }
    }

    // Get appropriate thumbnail URL for a file
    function getThumbnailUrl(file) {
      if (file.mimeType.includes('image/')) {
        return file.thumbnailLink ? file.thumbnailLink.replace('=s220', '=w400') : 
          `https://drive.google.com/thumbnail?id=${file.id}&sz=w400`;
      }
      if (file.mimeType.includes('video/')) {
        return 'https://img.icons8.com/color/96/000000/video-file.png';
      }
      return 'https://img.icons8.com/color/96/000000/google-drive-file.png';
    }

    // Display files in the gallery
    function displayFiles(files) {
      filteredFiles = files;
      gallery.innerHTML = '';
      
      files.forEach((file, index) => {
        const item = document.createElement('div');
        item.className = 'gallery-item';
        item.dataset.mimeType = file.mimeType;
        item.dataset.index = index;
        
        // Add animation delay for staggered loading effect
        item.style.animationDelay = `${index * 0.1}s`;
        
        item.innerHTML = `
          <img src="${file.thumbnail}" alt="${file.name}" 
               onerror="this.src='https://img.icons8.com/color/96/000000/google-drive-file.png'">
          <p>${truncateFileName(file.name)}</p>
        `;
        
        item.onclick = () => openLightbox(file, index);
        gallery.appendChild(item);
      });
    }

    // Filter files by type
    function filterFiles(type) {
      if (type === 'all') {
        displayFiles(allFiles);
      } else {
        const filtered = allFiles.filter(file => file.mimeType.includes(type));
        if (filtered.length === 0) {
          showEmptyMessage(`Brak plik√≥w typu ${type === 'image' ? 'zdjƒôƒá' : 'film√≥w'}`);
        } else {
          displayFiles(filtered);
        }
      }
    }

    // Open lightbox with the selected file
    function openLightbox(file, index) {
      currentFileIndex = index;
      lightbox.style.display = 'flex';
      lightboxError.style.display = 'none';
      lightboxImage.style.display = 'none';
      lightboxVideo.style.display = 'none';
      lightboxCaption.textContent = file.name;

      if (file.mimeType.includes('image/')) {
        lightboxImage.src = `https://drive.google.com/uc?export=view&id=${file.id}`;
        lightboxImage.style.display = 'block';
      } else if (file.mimeType.includes('video/')) {
        lightboxVideo.src = `https://drive.google.com/file/d/${file.id}/preview`;
        lightboxVideo.style.display = 'block';
      }
    }

    // Show error in lightbox
    function showLightboxError() {
      lightboxError.style.display = 'block';
      lightboxImage.style.display = 'none';
      lightboxVideo.style.display = 'none';
    }

    // Navigate between files in lightbox
    function navigateLightbox(direction) {
      currentFileIndex = (currentFileIndex + direction + filteredFiles.length) % filteredFiles.length;
      openLightbox(filteredFiles[currentFileIndex], currentFileIndex);
    }

    // Close lightbox
    function closeLightbox() {
      lightbox.style.display = 'none';
      lightboxImage.src = '';
      lightboxVideo.src = '';
      lightboxError.style.display = 'none';
    }

    // Helper functions
    function showLoader() {
      loader.style.display = 'block';
      emptyMessage.style.display = 'none';
    }

    function hideLoader() {
      loader.style.display = 'none';
    }

    function showEmptyMessage(message = 'W folderze nie ma jeszcze ≈ºadnych plik√≥w.') {
      emptyMessage.textContent = message;
      emptyMessage.style.display = 'block';
      gallery.innerHTML = '';
    }

    function clearGallery() {
      gallery.innerHTML = '';
      emptyMessage.style.display = 'none';
    }

    function showError(message) {
      emptyMessage.textContent = message;
      emptyMessage.style.display = 'block';
    }

    function truncateFileName(name, maxLength = 20) {
      if (name.length <= maxLength) return name;
      return name.substring(0, maxLength) + '...';
    }

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (lightbox.style.display === 'flex') {
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowLeft') navigateLightbox(-1);
        if (e.key === 'ArrowRight') navigateLightbox(1);
      }
    });
  </script>
  
  <!-- Load the Google API client library -->
  <script src="https://apis.google.com/js/api.js" onload="this.onload=function(){};gapi.load('client:auth2', initClient)"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</body>
</html>