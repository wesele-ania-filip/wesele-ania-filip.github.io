<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Galeria Miód Malina - Upload</title>
<script src="https://apis.google.com/js/api.js"></script>
</head>
<body>

<button id="loginBtn">Zaloguj się z Google</button>
<br><br>
<input type="file" id="fileInput" multiple />
<br><br>
<div id="status"></div>

<script>
const CLIENT_ID = '423158260926-21qotkdtat68fh814ilqmqkc82rdo1m8.apps.googleusercontent.com';  // <-- tu wklej
const FOLDER_ID = '1XZnCvIUSJ0VQ13AlDJHp8VWSM_zZueTk';  // <-- id folderu w Google Drive

let accessToken = '';

function initAuth() {
  return new Promise((resolve) => {
    gapi.load('auth2', () => {
      gapi.auth2.init({ client_id: CLIENT_ID }).then(() => {
        resolve();
      });
    });
  });
}

async function signIn() {
  const auth = gapi.auth2.getAuthInstance();
  try {
    const user = await auth.signIn();
    const token = user.getAuthResponse().access_token;
    accessToken = token;
    document.getElementById('status').innerText = 'Zalogowano!';
  } catch(e) {
    alert('Błąd logowania');
  }
}

function uploadFile(file) {
  if (!accessToken) {
    alert('Najpierw się zaloguj!');
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const base64Data = e.target.result;
    fetch('https://script.google.com/macros/s/AKfycbxUIioa9U4rlyCgD3CcRtROQC2cmv4rLegxvIULzg74ISKRfdBK-bKif0HHa2A45tQc/exec?action=upload&folderId=' + FOLDER_ID, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
      },
      body: new URLSearchParams({
        filename: file.name,
        mimeType: file.type,
        contents: base64Data
      })
    })
    .then(res => res.json())
    .then(data => {
      if(data.success) {
        document.getElementById('status').innerText = `Plik ${file.name} przesłany!`;
      } else {
        alert('Błąd uploadu: ' + data.error);
      }
    })
    .catch(err => alert('Błąd uploadu'));
  };
  reader.readAsDataURL(file);
}

window.onload = async () => {
  await initAuth();

  document.getElementById('loginBtn').onclick = signIn;

  document.getElementById('fileInput').addEventListener('change', (e) => {
    for (const file of e.target.files) {
      uploadFile(file);
    }
  });
};
</script>

</body>
</html>
